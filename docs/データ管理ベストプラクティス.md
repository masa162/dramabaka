# ãƒ‰ãƒ©ãƒãƒã‚«ä¸€ä»£ ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒ‰ãƒ©ãƒãƒã‚«ä¸€ä»£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®é‹ç”¨æ–¹é‡ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

---

## ğŸ—ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### åŸºæœ¬æ–¹é‡
- **ã‚·ãƒ³ãƒ—ãƒ«é€£ç•ªIDç®¡ç†**: 1300ç•ªå°ã‹ã‚‰é–‹å§‹
- **CSVä¸€å…ƒç®¡ç†**: ä¿¯ç°æ€§ã¨ç·¨é›†å®¹æ˜“æ€§ã‚’é‡è¦–
- **å‹å®‰å…¨æ€§**: TypeScript 100%å¯¾å¿œ
- **è‡ªå‹•åŒ–å„ªå…ˆ**: æ‰‹å‹•ä½œæ¥­ã®æœ€å°åŒ–

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
CSVç·¨é›† â†’ Git Push â†’ Vercelè‡ªå‹•ãƒ“ãƒ«ãƒ‰ â†’ é™çš„ã‚µã‚¤ãƒˆæ›´æ–°
```

---

## ğŸ“Š CSVãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

### 1. dramas_master.csvï¼ˆãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**ç›®çš„**: å…¨ãƒ‰ãƒ©ãƒã®åŸºæœ¬æƒ…å ±ç®¡ç†

```csv
id,title,slug,year,season,broadcaster,timeslot,air_day,genre,status,air_start,air_end,synopsis,cast
1301,ã¹ã‚‰ã¼ã†ã€œè”¦é‡æ „è¯ä¹ƒå¤¢å™ºã€œ,berabou,2025,winter,NHK,æ—¥8,sunday,taiga,airing,2025-01-05,2025-12-14,æ±Ÿæˆ¸æ™‚ä»£ã®å‡ºç‰ˆç•Œã§æ´»èºã—ãŸè”¦å±‹é‡ä¸‰éƒã®ç”Ÿæ¶¯ã‚’æã,"æ¨ªæµœæµæ˜Ÿ,ä¸­è°·ç¾ç´€"
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©**:
- `id`: é€šã—ç•ªå·ï¼ˆ1300ç•ªå°ï¼2025å¹´ï¼‰
- `title`: ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆæ­£å¼åç§°ï¼‰
- `slug`: URLç”¨ã‚¹ãƒ©ãƒƒã‚°ï¼ˆè‹±æ•°å­—ãƒ»ãƒã‚¤ãƒ•ãƒ³ã®ã¿ï¼‰
- `year`: æ”¾é€å¹´ï¼ˆ4æ¡ï¼‰
- `season`: å­£ç¯€ï¼ˆwinter/spring/summer/autumnï¼‰
- `broadcaster`: æ”¾é€å±€ï¼ˆNHK/ãƒ•ã‚¸/æ—¥ãƒ†ãƒ¬/TBS/ãƒ†ãƒ¬æœ/ãƒ†ãƒ¬æ±ï¼‰
- `timeslot`: æ”¾é€æ ï¼ˆæœˆ9/ç«10ç­‰ï¼‰
- `air_day`: æ›œæ—¥ï¼ˆmonday-sundayï¼‰
- `genre`: ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆæ‹æ„›/ã‚µã‚¹ãƒšãƒ³ã‚¹/åŒ»ç™‚ç­‰ï¼‰
- `status`: çŠ¶æ…‹ï¼ˆairing/completed/upcomingï¼‰
- `air_start`: é–‹å§‹æ—¥ï¼ˆYYYY-MM-DDï¼‰
- `air_end`: çµ‚äº†äºˆå®šæ—¥ï¼ˆYYYY-MM-DDï¼‰
- `synopsis`: ã‚ã‚‰ã™ã˜ï¼ˆ200æ–‡å­—ä»¥å†…ï¼‰
- `cast`: ä¸»è¦ã‚­ãƒ£ã‚¹ãƒˆï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰

### 2. archives_summary.csvï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚µãƒãƒªãƒ¼ï¼‰

**ç›®çš„**: å­£ç¯€ã”ã¨ã®çµ±è¨ˆãƒ»æ¦‚è¦æƒ…å ±

```csv
year,season,drama_count,avg_baka_level,top_dramas,summary,id_range_start,id_range_end
2024,autumn,35,3.2,"ã‚¢ãƒ³ãƒãƒ’ãƒ¼ãƒ­ãƒ¼,ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼,ãƒ–ãƒ©ãƒƒã‚¯ãƒšã‚¢ãƒ³",ä»ŠæœŸã¯è³ªã®é«˜ã„ã‚µã‚¹ãƒšãƒ³ã‚¹ä½œå“ãŒç›®ç«‹ã£ãŸ,1265,1299
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©**:
- `year`: å¹´åº¦
- `season`: å­£ç¯€
- `drama_count`: ãƒ‰ãƒ©ãƒæœ¬æ•°
- `avg_baka_level`: å¹³å‡ãƒã‚«åº¦ï¼ˆ1.0-5.0ï¼‰
- `top_dramas`: æ³¨ç›®ä½œå“ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€æœ€å¤§5æœ¬ï¼‰
- `summary`: å­£ç¯€ç·è©•ï¼ˆ200æ–‡å­—ä»¥å†…ï¼‰
- `id_range_start`: IDç¯„å›²é–‹å§‹
- `id_range_end`: IDç¯„å›²çµ‚äº†

---

## ğŸ”¢ IDç®¡ç†ä½“ç³»

### é€£ç•ªãƒ«ãƒ¼ãƒ«
```
1001-1099: 2022å¹´ï¼ˆ99æœ¬ã¾ã§ï¼‰
1100-1199: 2023å¹´ï¼ˆ99æœ¬ã¾ã§ï¼‰
1200-1299: 2024å¹´ï¼ˆ99æœ¬ã¾ã§ï¼‰
1300-1399: 2025å¹´ï¼ˆ99æœ¬ã¾ã§ï¼‰
1400-1499: 2026å¹´ï¼ˆ99æœ¬ã¾ã§ï¼‰
```

### IDå‰²ã‚Šå½“ã¦æŒ‡é‡
- **å­£ç¯€é †**: å†¬â†’æ˜¥â†’å¤â†’ç§‹ã®é †ã§é€£ç•ª
- **æ”¾é€å±€é †**: NHKâ†’æ—¥ãƒ†ãƒ¬â†’TBSâ†’ãƒ•ã‚¸â†’ãƒ†ãƒ¬æœâ†’ãƒ†ãƒ¬æ±
- **äºˆç´„æ **: å„å¹´åº¦æœ€å¾Œã®10ç•ªã¯ç‰¹åˆ¥ç•ªçµ„ç”¨ï¼ˆä¾‹ï¼š1390-1399ï¼‰

---

## ğŸ“… é‹ç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### é€±æ¬¡é‹ç”¨ï¼ˆ5-10åˆ†ï¼‰

#### 1. æ–°ãƒ‰ãƒ©ãƒè¿½åŠ 
```bash
# 1. CSVã«1è¡Œè¿½åŠ 
echo "1311,æ–°ç•ªçµ„,shin-bangumi,2025,winter,ãƒ•ã‚¸,æœˆ9,monday,æ‹æ„›,upcoming,2025-04-01,2025-06-30,æ–°ã—ã„æ‹æ„›ãƒ‰ãƒ©ãƒ,ä¸»æ¼”A,ä¸»æ¼”B" >> dramas_master.csv

# 2. Git Push
git add src/lib/data/dramas_master.csv
git commit -m "Add new drama: æ–°ç•ªçµ„"
git push

# 3. è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼ˆç´„3åˆ†ï¼‰
```

#### 2. çŠ¶æ…‹æ›´æ–°
```bash
# airingã‚’completedã«å¤‰æ›´
sed -i 's/1301,ã¹ã‚‰ã¼ã†,berabou,2025,winter,NHK,æ—¥8,sunday,taiga,airing/1301,ã¹ã‚‰ã¼ã†,berabou,2025,winter,NHK,æ—¥8,sunday,taiga,completed/' dramas_master.csv
```

### å­£ç¯€åˆ‡ã‚Šæ›¿ãˆï¼ˆ20-30åˆ†ï¼‰

#### 1. å‰å­£ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–åŒ–
```bash
# archives_summary.csvã«è¿½åŠ 
echo "2025,winter,54,3.1,\"ã¹ã‚‰ã¼ã†,ã‚ã‚“ã±ã‚“,èª˜æ‹ã®æ—¥\",2025å¹´å†¬ã¯å¤šæ§˜ãªã‚¸ãƒ£ãƒ³ãƒ«ãŒæƒã£ãŸè±Šä½œå­£,1301,1354" >> archives_summary.csv
```

#### 2. æ–°å­£åº¦æº–å‚™
```bash
# æ–°ã—ã„IDç¯„å›²é–‹å§‹ï¼ˆ1400ç•ªå°ï¼2026å¹´æ˜¥ï¼‰
# dramas_master.csvã«æ–°å­£ãƒ‰ãƒ©ãƒã‚’è¿½åŠ é–‹å§‹
```

### å¹´æ¬¡é‹ç”¨ï¼ˆ1æ™‚é–“ï¼‰

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
```bash
# å¹´åº¦æœ«ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp dramas_master.csv backups/dramas_master_2025.csv
cp archives_summary.csv backups/archives_summary_2025.csv
```

#### 2. çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- å¹´é–“ç·æœ¬æ•°
- æœ€é«˜ãƒã‚«åº¦ä½œå“
- ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥åˆ†æ
- æ”¾é€å±€åˆ¥å®Ÿç¸¾

---

## ğŸ›¡ï¸ ãƒ‡ãƒ¼ã‚¿å“è³ªç®¡ç†

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«

#### å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®
1. **IDé‡è¤‡**: `sort dramas_master.csv | cut -d, -f1 | uniq -d`
2. **æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: YYYY-MM-DDå½¢å¼
3. **æ”¾é€å±€å**: æ±ºã‚ã‚‰ã‚ŒãŸ6å±€ã®ã¿
4. **å­£ç¯€å**: winter/spring/summer/autumnã®ã¿
5. **çŠ¶æ…‹**: airing/completed/upcomingã®ã¿

#### CSVæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹
```bash
#!/bin/bash
# validate_csv.sh

echo "=== CSVæ¤œè¨¼é–‹å§‹ ==="

# IDé‡è¤‡ãƒã‚§ãƒƒã‚¯
duplicates=$(tail -n +2 dramas_master.csv | cut -d, -f1 | sort | uniq -d)
if [ -n "$duplicates" ]; then
    echo "âŒ é‡è¤‡IDç™ºè¦‹: $duplicates"
    exit 1
fi

# å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
while IFS=, read -r id title slug year season broadcaster timeslot air_day genre status air_start air_end synopsis cast; do
    if [ -z "$id" ] || [ -z "$title" ] || [ -z "$slug" ]; then
        echo "âŒ å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸è¶³: ID=$id, TITLE=$title"
        exit 1
    fi
done < <(tail -n +2 dramas_master.csv)

echo "âœ… CSVæ¤œè¨¼å®Œäº†"
```

---

## ğŸ”„ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

### ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ç§»è¡Œ
```typescript
// æ—§weekly-dramas.tsã‹ã‚‰æ–°CSVå½¢å¼ã¸ã®ç§»è¡Œ
const migrationScript = {
  convertWeeklyDramasToCSV: (weeklyDramas: WeeklyDrama[]) => {
    return weeklyDramas.map((drama, index) => ({
      id: 1301 + index,
      title: drama.title,
      slug: drama.slug,
      year: 2025,
      season: 'winter',
      broadcaster: drama.broadcaster,
      timeslot: drama.timeslot,
      air_day: drama.airDay,
      genre: drama.genre[0],
      status: drama.status,
      air_start: '2025-01-01',
      air_end: '2025-03-31',
      synopsis: '',
      cast: []
    }))
  }
}
```

#### 2. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›´æ™‚ã®å¯¾å¿œ
```bash
# æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ™‚
awk 'BEGIN{FS=OFS=","} NR==1{$NF=$NF",new_field"} NR>1{$NF=$NF",default_value"}' dramas_master.csv > dramas_master_new.csv
```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### CSVèª­ã¿è¾¼ã¿æœ€é©åŒ–

#### 1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç®¡ç†
- **ç¾åœ¨**: 10KBï¼ˆ54æœ¬ï¼‰
- **2å¹´å¾Œäºˆæƒ³**: 50KBï¼ˆ300æœ¬ï¼‰
- **5å¹´å¾Œäºˆæƒ³**: 100KBï¼ˆ600æœ¬ï¼‰

#### 2. èª­ã¿è¾¼ã¿æˆ¦ç•¥
```typescript
// æ®µéšçš„ãƒ­ãƒ¼ãƒ‰å®Ÿè£…ä¾‹
export async function loadDramasIncremental() {
  // ç¾åœ¨ã‚·ãƒ¼ã‚ºãƒ³ã®ã¿å³åº§ãƒ­ãƒ¼ãƒ‰
  const currentSeason = await loadCurrentSeasonDramas()
  
  // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¯é…å»¶ãƒ­ãƒ¼ãƒ‰
  const archivePromise = loadArchiveData()
  
  return {
    current: currentSeason,
    archives: archivePromise
  }
}
```

#### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
```typescript
// ãƒ“ãƒ«ãƒ‰æ™‚é™çš„ç”Ÿæˆ + ISR
export const revalidate = 3600 // 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥

export async function generateStaticParams() {
  // ãƒ“ãƒ«ãƒ‰æ™‚ã«å…¨ãƒšãƒ¼ã‚¸ç”Ÿæˆ
  const archives = await loadArchiveData()
  return generateAllParams(archives)
}
```

---

## ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¯¾å¿œ

#### 1. CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
```typescript
export async function loadDramasWithFallback() {
  try {
    return await loadDramasFromCSV()
  } catch (error) {
    console.error('CSV loading failed:', error)
    return await loadDramasFromBackup()
  }
}
```

#### 2. ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆã‚¨ãƒ©ãƒ¼
```typescript
export function validateDramaData(drama: DramaMaster): boolean {
  const validBroadcasters = ['NHK', 'ãƒ•ã‚¸', 'æ—¥ãƒ†ãƒ¬', 'TBS', 'ãƒ†ãƒ¬æœ', 'ãƒ†ãƒ¬æ±']
  const validSeasons = ['winter', 'spring', 'summer', 'autumn']
  
  return (
    drama.id > 1000 &&
    validBroadcasters.includes(drama.broadcaster) &&
    validSeasons.includes(drama.season)
  )
}
```

#### 3. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼
```yaml
# GitHub Actionsä¾‹
- name: Validate CSV
  run: |
    npm run validate-csv
    if [ $? -ne 0 ]; then
      echo "CSV validation failed"
      exit 1
    fi
```

---

## ğŸ“Š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### KPIè¿½è·¡

#### 1. ãƒ‡ãƒ¼ã‚¿å“è³ªæŒ‡æ¨™
- CSVæ¤œè¨¼ã‚¨ãƒ©ãƒ¼ç‡: < 1%
- ãƒ“ãƒ«ãƒ‰æˆåŠŸç‡: > 99%
- ãƒšãƒ¼ã‚¸ç”Ÿæˆæ™‚é–“: < 3åˆ†

#### 2. é‹ç”¨åŠ¹ç‡æŒ‡æ¨™
- é€±æ¬¡æ›´æ–°æ™‚é–“: < 10åˆ†
- å­£ç¯€åˆ‡ã‚Šæ›¿ãˆæ™‚é–“: < 30åˆ†
- ã‚¨ãƒ©ãƒ¼å¯¾å¿œæ™‚é–“: < 1æ™‚é–“

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
- ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“: < 2ç§’
- CSVèª­ã¿è¾¼ã¿æ™‚é–“: < 100ms
- é™çš„ç”Ÿæˆæ™‚é–“: < 5ç§’

---

## ğŸ”® å°†æ¥æ‹¡å¼µè¨ˆç”»

### Phase 2: APIåŒ–ï¼ˆ1å¹´å¾Œï¼‰
```typescript
// RESTful APIè¨­è¨ˆä¾‹
GET /api/dramas              // å…¨ãƒ‰ãƒ©ãƒä¸€è¦§
GET /api/dramas/:id          // å€‹åˆ¥ãƒ‰ãƒ©ãƒè©³ç´°
GET /api/dramas/season/:year/:season  // å­£ç¯€åˆ¥ä¸€è¦§
GET /api/archives            // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ä¸€è¦§
POST /api/dramas             // æ–°è¦ãƒ‰ãƒ©ãƒè¿½åŠ ï¼ˆç®¡ç†è€…ç”¨ï¼‰
```

### Phase 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç§»è¡Œï¼ˆ2å¹´å¾Œï¼‰
```sql
-- PostgreSQLè¨­è¨ˆä¾‹
CREATE TABLE dramas (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    year INTEGER NOT NULL,
    season season_enum NOT NULL,
    broadcaster broadcaster_enum NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Phase 4: å¤–éƒ¨é€£æºï¼ˆ3å¹´å¾Œï¼‰
- TVã‚¬ã‚¤ãƒ‰APIé€£æº
- è¦–è´ç‡ãƒ‡ãƒ¼ã‚¿å–å¾—
- SNSæ„Ÿæƒ³ãƒ‡ãƒ¼ã‚¿åé›†

---

## ğŸ“ ã¾ã¨ã‚

ã“ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

âœ… **é‹ç”¨è² è·æœ€å°åŒ–**: é€±5åˆ†ã®æ›´æ–°ä½œæ¥­
âœ… **ãƒ‡ãƒ¼ã‚¿å“è³ªç¢ºä¿**: å‹å®‰å…¨æ€§ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
âœ… **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: 10å¹´é–“1000æœ¬å¯¾å¿œ
âœ… **ä¿å®ˆæ€§å‘ä¸Š**: CSVç®¡ç†ã®åˆ†ã‹ã‚Šã‚„ã™ã•
âœ… **è‡ªå‹•åŒ–æ¨é€²**: GitHub Actionsé€£æº

å®šæœŸçš„ã«ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ç›´ã—ã€é‹ç”¨å®Ÿç¸¾ã«åŸºã¥ã„ã¦æ”¹å–„ã—ã¦ã„ãã¾ã™ã€‚

---

*æœ€çµ‚æ›´æ–°: 2025-07-16*
*æ¬¡å›è¦‹ç›´ã—: 2025-10-16*